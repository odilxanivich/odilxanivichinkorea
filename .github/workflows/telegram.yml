name: Send Markdown Title and Summary to Telegram

on:
  push:
    paths:
      - "*.md"

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Get latest Markdown file
        id: mdfile
        run: |
          FILE=$(git diff --name-only HEAD~1 HEAD | grep '.md$' | head -n 1)
          echo "file=$FILE" >> $GITHUB_OUTPUT

      - name: Extract title and summary
        id: extract
        run: |
          TITLE=$(head -n 1 ${{ steps.mdfile.outputs.file }})
          SUMMARY=$(head -n 5 ${{ steps.mdfile.outputs.file }} | tail -n +2)
          echo "title=$TITLE" >> $GITHUB_OUTPUT
          echo "summary=$SUMMARY" >> $GITHUB_OUTPUT

      - name: Send to Telegram
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          message: |
            *${{ steps.extract.outputs.title }}*
            _${{ steps.extract.outputs.summary }}_
